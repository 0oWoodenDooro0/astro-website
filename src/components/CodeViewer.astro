---
import { Code } from 'astro:components';

interface Props {
  code: string;
  lang: string;
  filename: string;
}

const { code, lang, filename } = Astro.props;
---

<div class="code-viewer-container border border-ctp-surface0 rounded-xl overflow-hidden bg-ctp-crust shadow-2xl font-mono">
  <div class="bg-ctp-mantle px-4 py-3 border-b border-ctp-surface0 flex items-center justify-between">
    <div class="flex items-center gap-3">
      <div class="flex gap-1.5">
        <div class="w-3 h-3 rounded-full bg-ctp-red/50"></div>
        <div class="w-3 h-3 rounded-full bg-ctp-yellow/50"></div>
        <div class="w-3 h-3 rounded-full bg-ctp-green/50"></div>
      </div>
      <span class="text-xs text-ctp-overlay1 ml-2 flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/></svg>
        {filename}
      </span>
    </div>
    <button
      id="copy-button"
      class="text-ctp-overlay1 hover:text-ctp-pink transition-colors p-1 rounded"
      title="Copy to clipboard"
    >
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>
    </button>
  </div>
  
  <div class="p-0 text-sm relative">
    <Code code={code} lang={lang as any} theme="catppuccin-mocha" wrap={false} />
  </div>
</div>

<script is:inline define:vars={{ code }}>
  const copyButton = document.getElementById('copy-button');
  copyButton?.addEventListener('click', () => {
    navigator.clipboard.writeText(code);
    const originalIcon = copyButton.innerHTML;
    copyButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></svg>`;
    setTimeout(() => {
      copyButton.innerHTML = originalIcon;
    }, 2000);
  });
</script>

<style is:global>
  .code-viewer-container pre {
    background-color: transparent !important;
    padding: 1.5rem !important;
    margin: 0 !important;
    overflow-x: auto;
  }
  /* Line numbers styling if supported by Astro Code component or through CSS */
  .code-viewer-container code {
    counter-reset: line;
  }
  .code-viewer-container .line {
    display: block;
  }
  .code-viewer-container .line::before {
    counter-increment: line;
    content: counter(line);
    display: inline-block;
    width: 2rem;
    margin-right: 1.5rem;
    text-align: right;
    color: var(--ctp-surface2);
    user-select: none;
  }
</style>
